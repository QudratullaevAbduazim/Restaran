<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Update — Rustaq Restaurant</title>

    <!-- Google Fonts (optional) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

    <style>
        :root{
            --accent: #c0392b;
            --muted: #6f6f6f;
            --card:#fff;
            --bg: #fbf7f6;
            --radius:12px;
            --shadow: 0 10px 30px rgba(20,20,20,0.06);
            --max-width:960px;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(180deg,#fff,#fbf7f6);
            color:#222;
            -webkit-font-smoothing:antialiased;
            padding:24px;
        }

        .container{
            max-width:var(--max-width);
            margin:20px auto;
            background:var(--card);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            overflow:hidden;
        }

        header.app-header{
            background: linear-gradient(120deg, rgba(192,57,43,0.95), rgba(236,112,99,0.95));
            color:white;
            padding:18px 22px;
            display:flex;
            align-items:center;
            justify-content:space-between;
        }
        .brand{display:flex;gap:12px;align-items:center}
        .logo{width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-family:Playfair Display,serif;font-size:20px}
        .brand h1{margin:0;font-size:16px;font-family:Playfair Display,serif}
        .brand p{margin:0;font-size:12px;opacity:0.95}

        .header-actions a{
            text-decoration:none;
            color:var(--accent);
            background:white;
            padding:8px 12px;
            border-radius:8px;
            font-weight:700;
        }

        .main{padding:24px}

        .page-title{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            margin-bottom:16px;
        }
        .page-title h2{margin:0;font-family:Playfair Display,serif;font-size:20px}
        .page-title p{margin:0;color:var(--muted);font-size:13px}

        form.grid{
            display:grid;
            grid-template-columns: 1fr 360px;
            gap:20px;
            align-items:start;
        }
        @media (max-width:980px){
            form.grid{grid-template-columns:1fr}
        }

        .card{
            background:var(--card);
            border-radius:10px;
            padding:16px;
            box-shadow:0 6px 18px rgba(20,20,20,0.04);
        }

        .field{margin-bottom:12px; display:flex; flex-direction:column; gap:8px}
        label{font-weight:600; font-size:14px}
        input[type="text"], input[type="number"], textarea, select {
            padding:10px 12px;
            border:1px solid #eee;
            border-radius:8px;
            font-size:14px;
            background:#fff;
        }
        textarea{min-height:100px; resize:vertical}

        .inline-row{display:flex; gap:12px}
        .inline-row .small{flex:1; min-width:0}

        .help{font-size:13px;color:var(--muted)}

        .form-actions{
            display:flex;
            gap:12px;
            margin-top:8px;
            align-items:center;
        }
        .btn{
            padding:10px 14px;
            border-radius:10px;
            text-decoration:none;
            font-weight:700;
            border:0;
            cursor:pointer;
        }
        .btn-primary{
            background:var(--accent);
            color:white;
            box-shadow:0 8px 20px rgba(192,57,43,0.12);
        }
        .btn-cancel{
            background:transparent;
            color:var(--muted);
            border:1px solid #eee;
        }
        .btn-danger{
            background:#8b2a22;
            color:white;
            border-radius:8px;
            padding:8px 10px;
            font-weight:700;
            text-decoration:none;
        }

        /* image preview */
        .image-panel{
            display:flex;
            flex-direction:column;
            gap:12px;
        }
        .image-preview{
            border-radius:10px;
            overflow:hidden;
            background:linear-gradient(180deg,#f6f3f2,#efe9e7);
            height:240px;
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;
        }
        .image-preview img{
            width:100%;
            height:100%;
            object-fit:cover;
            display:block;
        }
        .image-placeholder{
            color:#bba8a6;
            text-align:center;
            padding:18px;
            font-size:14px;
        }

        .errors{
            background:#fff6f6;
            border:1px solid rgba(192,57,43,0.08);
            color:#9b2b23;
            padding:10px 12px;
            border-radius:8px;
            margin-bottom:12px;
            font-size:14px;
        }

        footer.form-footer{
            margin-top:14px;
            color:var(--muted);
            font-size:13px;
        }

        /* focus for accessibility */
        a:focus, button:focus, input:focus, textarea:focus { outline:3px solid rgba(43,78,255,0.12); outline-offset:2px; }
    </style>
</head>
<body>
    <div class="container" role="main">
        <header class="app-header" role="banner" aria-label="Header">
            <div class="brand">
                <div class="logo" aria-hidden="true">R</div>
                <div>
                    <h1>Rustaq Restaurant</h1>
                    <p>Menyu: taomni yangilash</p>
                </div>
            </div>

            <div class="header-actions">
                <a href="{% url 'myapp:home_page' %}">Back to Menu</a>
            </div>
        </header>

        <div class="main">
            <div class="page-title" aria-hidden="false">
                <div>
                    <h2>Update Food</h2>
                    <p>Taom ma'lumotlarini yangilang va saqlang — rasmni almashtirish mumkin.</p>
                </div>
                <div style="display:flex;gap:8px;align-items:center">
                    <a class="btn btn-danger" href="{% url 'myapp:delete_food' food.id %}">Delete</a>
                </div>
            </div>

            <form method="POST" enctype="multipart/form-data" class="grid" novalidate>
                {% csrf_token %}

                <div class="card" aria-label="Update form">
                    {% if form.non_field_errors %}
                        <div class="errors">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}

                    <div class="field">
                        <label for="{{ form.name.id_for_label }}">Name</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="errors">{{ form.name.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="inline-row">
                        <div class="field small">
                            <label for="{{ form.price.id_for_label }}">Price</label>
                            {{ form.price }}
                            {% if form.price.errors %}
                                <div class="errors">{{ form.price.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="field small">
                            <label for="{{ form.category.id_for_label }}">Category</label>
                            {{ form.category }}
                            {% if form.category.errors %}
                                <div class="errors">{{ form.category.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="field">
                        <label for="{{ form.desc.id_for_label }}">Description</label>
                        {{ form.desc }}
                        {% if form.desc.errors %}
                            <div class="errors">{{ form.desc.errors }}</div>
                        {% endif %}
                        <div class="help">Mahsulot haqida ta'rif — mijozni jalb qiladigan 1-2 jumla.</div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <a class="btn btn-cancel" href="{% url 'myapp:home_page' %}">Cancel</a>
                    </div>

                    <footer class="form-footer">
                        Tip: yangi rasm yuklash buyurtmalarni oshirishi mumkin. Tavsiya: 1200×800 px.
                    </footer>
                </div>

                <aside class="card image-panel" aria-label="Image upload & preview">
                    <div>
                        <label for="{{ form.image.id_for_label }}">Image</label>
                        {{ form.image }}
                        {% if form.image.errors %}
                            <div class="errors">{{ form.image.errors }}</div>
                        {% endif %}
                        <div class="help">Rasmni almashtirish uchun yangi fayl tanlang.</div>
                    </div>

                    <div class="image-preview" id="preview">
                        {% if form.instance and form.instance.image %}
                            <img id="preview-img" src="{{ form.instance.image.url }}" alt="Current image preview">
                        {% else %}
                            <div class="image-placeholder" id="preview-placeholder">No image selected</div>
                        {% endif %}
                    </div>

                    <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
                        <div style="font-size:13px;color:var(--muted)">Hozirgi holat: <strong>{% if form.instance and form.instance.available %}Available{% else %}Not available{% endif %}</strong></div>
                        <div>
                            {% if form.available %}
                                {{ form.available }}
                            {% endif %}
                        </div>
                    </div>
                </aside>
            </form>
        </div>
    </div>

    <script>
        // Image preview for file input
        (function(){
            const fileInput = document.querySelector('input[type="file"][name$="image"], input[type="file"][name="image"]');
            if (!fileInput) return;

            const preview = document.getElementById('preview');
            const previewImg = document.getElementById('preview-img');
            const placeholder = document.getElementById('preview-placeholder');

            fileInput.addEventListener('change', function (e) {
                const file = this.files && this.files[0];
                if (!file) {
                    if (previewImg) { previewImg.remove(); }
                    if (placeholder) placeholder.style.display = 'block';
                    return;
                }

                // Quick client-side validation (image types)
                if (!file.type.startsWith('image/')) {
                    alert('Iltimos, rasmlar uchun mos fayl tanlang.');
                    this.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (ev) {
                    if (placeholder) placeholder.style.display = 'none';
                    if (previewImg) {
                        previewImg.src = ev.target.result;
                    } else {
                        const img = document.createElement('img');
                        img.id = 'preview-img';
                        img.alt = 'Selected image preview';
                        img.src = ev.target.result;
                        preview.innerHTML = '';
                        preview.appendChild(img);
                    }
                };
                reader.readAsDataURL(file);
            });
        })();

        // accessibility: focus the update button for keyboard users
        (function(){
            var btn = document.querySelector('button[type="submit"]');
            if(btn) btn.focus();
        })();
    </script>
</body>
</html>